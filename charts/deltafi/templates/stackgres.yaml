{{- if .Values.postgres.enabled }}
apiVersion: stackgres.io/v1
kind: SGScript
metadata:
  name: deltafi-postgres-create-db
  namespace: deltafi
spec:
  managedVersions: true
  continueOnError: false
  scripts:
  - name: create-deltafi-user
    scriptFrom:
      secretKeyRef:
        name: postgres
        key: create-user.sql
  - name: create-deltafi-database
    script: |
      CREATE DATABASE deltafi WITH OWNER deltafi;
---
apiVersion: stackgres.io/v1
kind: SGCluster
metadata:
  name: deltafi-postgres
spec:
  instances: 1
  postgres:
    version: {{ .Values.postgres.version | default "latest" | quote }}
  pods:
    persistentVolume:
      size: '5Gi'
  managedSql:
    scripts:
    - sgScript: deltafi-postgres-create-db
{{ end }}
