plugins {
    id 'java'
    id 'io.quarkus'
    id 'idea'
    id "com.palantir.docker" version "0.22.1"
}

java {
    sourceCompatibility = javaSourceCompatibility
    targetCompatibility = javaTargetCompatibility
}

compileJava {
    options.encoding = 'UTF-8'
    options.compilerArgs << '-parameters'
}

compileTestJava {
    options.encoding = 'UTF-8'
}

dependencies {
    implementation project(":deltafi-common")
    implementation enforcedPlatform("${quarkusPlatformGroupId}:${quarkusPlatformArtifactId}:${quarkusPlatformVersion}")
    implementation project(path: ':deltafi-dgs', configuration: 'jars')
    implementation 'io.quarkus:quarkus-resteasy'
    implementation 'io.quarkus:quarkus-resteasy-jackson'
    implementation 'io.quarkiverse.minio:quarkus-minio'
    implementation 'io.quarkus:quarkus-arc'
    implementation 'io.quarkus:quarkus-kotlin'
    implementation 'com.netflix.graphql.dgs:graphql-dgs-client:3.11.0'
    implementation 'com.fasterxml.jackson.module:jackson-module-kotlin'
    implementation('io.quarkiverse.loggingjson:quarkus-logging-json:0.3.1') {
        because 'Plugin to allow JSON formatted logging for log scraping'
    }
    testImplementation 'io.quarkus:quarkus-junit5'
    testImplementation 'io.quarkus:quarkus-junit5-mockito'
    testImplementation 'io.rest-assured:rest-assured'
    testImplementation 'org.mockito:mockito-junit-jupiter'
}

docker {
    dependsOn compileJava
    dependsOn build
    name "${project.name}:${project.version}"
    copySpec.from(".").into(".")
}
