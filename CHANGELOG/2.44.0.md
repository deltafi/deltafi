## [2.44.0] - 2025-12-17

### Added
- Added ability to show hyperlinks in descriptions in our json renderers. 
- Queue Metrics page: Per-flow breakdown of warm and cold queue metrics with flow type, action name, and plugin tooltips
- Queue Metrics page: "Oldest" timestamp column showing how long items have been queued (for both warm and cold queues)
- Queue Metrics page: Roll-up by action class toggle to aggregate metrics across flows
- Queue Metrics page: Running Tasks panel showing currently executing actions with DID links, duration, and worker info
- REST API: `/api/v2/metrics/queues/detailed` endpoint for per-flow queue metrics
- REST API: `/api/v2/metrics/queues/action-plugins` endpoint for action class to plugin mapping
- REST API: `/api/v2/metrics/queues/running` endpoint for currently executing tasks
- Database: `cold_queue_entries` table with trigger-maintained per-item tracking for accurate oldest timestamps
- Add oldest in flight DeltaFile age to Dashboard and Leader Dashboard
- Dozzle log viewer added to main administration sidebar
- Vector log aggregation to the local file system
- Logrotate added to monitor log files with configurable size-based and time-based rotation
- Log stack can be disabled in the compose stack (`deltafi.logs.enable: false`)
- Comprehensive logging documentation at `/operating/logging`
- Site values template updated with logging configuration defaults
- Added `-o/--format` flag to `deltafi data-sink get` for output format consistency
- Added `flowFileVersion` parameter to FlowfileEgress action (V1 default, V3 available)
- Added `/capture` endpoint to deltafi-egress-sink for saving egressed files to disk without requiring headers
- EnvVar parameter type for secure handling of secrets via environment variables
- EnvVarRenderer UI component with warning message and UPPER_SNAKE_CASE validation
- Site Configuration documentation covering site/values.yaml, site/compose.yaml, and site/templates/
- Added `acknowledgeByFlow` and `acknowledgeByMessage` GraphQL mutations to acknowledge errors by flow or error message instead of by DID list
- Added `annotateByFlow` and `annotateByMessage` GraphQL mutations to annotate DeltaFiles by flow or error message instead of by DID list
- Fleet Search page for searching DeltaFiles across all fleet members with aggregated counts. Find your data across multiple systems.
- API: Federated search endpoint for querying DeltaFile counts across fleet members
- API: Aggregated search options endpoint combining flow names, topics, and annotation keys from all members
- `FilterLines` transform action for line-based content filtering and selection. Supports:
  - `headLines` - Keep only the first N lines (after skip)
  - `tailLines` - Keep only the last N lines (after head)
  - `skipLines` - Skip the first N lines (e.g., for header removal)
  - `includePatterns` - List of regex patterns to keep matching lines
  - `excludePatterns` - List of regex patterns to remove matching lines
  - `includeMatchMode` / `excludeMatchMode` - Control pattern matching logic (OR: match any, AND: match all)
  - `keepEmpty` - Keep or remove empty lines (default: true)
  - `lineDelimiter` - Custom line delimiter (default: `\n`)
  - `preserveDelimiter` - Preserve original delimiter or use system line separator
  - Inherits content selection parameters from `ContentSelectingTransformAction`
- Added `enable.local_object_storage` configuration option (replaces `enable.minio`)
- Async plugin reconciliation service that manages plugin desired state vs actual state
- Plugin installation states: PENDING, INSTALLING, INSTALLED, FAILED, REMOVING
- Rollback support for failed plugin upgrades when a previous version was successful
- Disable/enable plugin functionality to stop plugins without losing configuration
- TUI: `deltafi plugin list` now shows plugin installation status and rollback availability
- TUI: `deltafi plugin disable <name>` to disable a plugin
- TUI: `deltafi plugin enable <name>` to enable a disabled plugin
- TUI: `deltafi plugin rollback <name>` to rollback a failed upgrade
- TUI: `deltafi plugin retry <name>` to retry a failed installation
- Flow behavior now considers plugin state: data queues during plugin upgrades instead of being rejected
- Plugin icon with tooltip on Data Sources and Data Sinks pages (links to plugin details like Transforms page)
- DeltaFile Viewer: Flow Graph tab showing visual journey through flows with state coloring, elapsed times, and clickable error/filtered nodes
- `terminateAllWithError` GraphQL mutation to mark all in-flight DeltaFiles as ERROR with a custom message. Useful for graceful shutdown or halting processing while preserving the ability to resume/replay affected files.
- New TimedDataSourceCheck reports flows with unhealthy ingress status

### Changed
- Grafana dashboards reorganized into `core/` and `logs/` subdirectories for better organization
- Grafana datasources configuration updated to remove Loki
- Nginx configuration updated with auth cache settings
- `deltafi transform load` and `deltafi data-sink load` now use positional file arguments and support multiple files like `deltafi data-source load file1.json file2.json`
- Updated the `Getting Started Developing a Simple Plugin` documentation and source to match the current code base
- Content API now uses pointer-based requests (DID, flowNumber, actionIndex, contentIndex) instead of raw segments
- Server resolves content location from DeltaFile structure, enabling future entitlement checks
- SftpIngress now supports passwordEnvVar field for secure password handling (password field deprecated but still functional)
- Error summary queries no longer return DIDs via ARRAY_AGG, significantly improving query performance
- Errors page "All" tab now shows DeltaFiles with any flow in ERROR state, not just DeltaFiles with stage=ERROR. This allows users to see errors immediately even while other flows are still processing
- UI bulk actions (acknowledge, annotate) on the "By Flow" and "By Message" tabs now use the new filter-based mutations instead of passing DID lists
- Bulk operations (resume, acknowledge, annotate) now show real-time progress with percentage and count
- Bulk operations can be stopped mid-operation with a Stop button
- Modify Metadata dialogs for resume and replay now show blank inputs for batch operations instead of attempting to aggregate metadata across all DeltaFiles
- `ResumeMetadata` input type now has optional `flow` and `action` fields; when null, metadata applies to all errored flows/actions
- Replace MinIO with s3proxy for S3-compatible object storage (MinIO is no longer open source)
- Plugin installation is now asynchronous - returns immediately after queuing
- Invalid flows now queue data instead of rejecting it (data resumes when flow becomes valid)
- Invalid flows can now be paused/stopped without first resolving validation errors
- Flows with unavailable plugins (PENDING/INSTALLING/FAILED) now queue data instead of rejecting it
- Only explicitly STOPPED flows or Disabled plugins reject data; all other unavailability queues data
- Flow tooltips now show "(data flow paused)" when plugin is unavailable
- Split system map into revamped full and detail views. Include start/stop/pause controls, error indicators/links, detailed flow info panel, and metrics display
- DeltaFile Viewer: Reorganized into tabbed interface (*new* Flow Graph, Flow Table, Flow Trace)
- DeltaFile Viewer: Panel headers now show item counts and auto-collapse when empty (Parent/Child DIDs, Content Tags, Annotations)

### Fixed
- Fixed race condition in HeartbeatService where action execution could become null between filter and use, causing running tasks to not be reported (Java plugins must be rebuilt to get this fix)
- `deltafi data-sink load` was broken due to missing flag registration
- Fixed errors badge in sidebar showing incorrect count (capped at 10k) instead of actual error count
- UI: Fixed layout bug on Fleet Dashboard
- Docker: Leftover containers are removed before plugin install to prevent 409 Conflict errors
- Snapshot restore now correctly identifies plugin upgrades vs new installs by image name

### Removed
- Loki removed from compose orchestration
- Promtail removed from compose orchestration
- Grafana log dashboards removed from compose orchestration (log viewing now uses Dozzle)
- Graphite configuration files removed from compose orchestration
- Removed `deltafi minio` CLI commands (s3proxy does not include MinIO client)
- Removed SNOWBALL bulk upload support (MinIO-specific feature not supported by s3proxy)
- `pluginAutoRollback` property - rollback is now manual via `deltafi plugin rollback <plugin>`

### Deprecated
- `deltafi transform load -f` flag is deprecated; use positional arguments instead
- FlowfileEgress V1 format - V3 will become the default in a future version
- SftpIngress.password field (use passwordEnvVar instead)
- `dids` field on `CountPerFlow` and `CountPerMessage` GraphQL types (now returns null)
- `errorMetadataUnion` and `sourceMetadataUnion` GraphQL queries (use `deltaFile` query for single DeltaFile metadata)
- `enable.minio` configuration option (use `enable.local_object_storage` instead)
- `SNOWBALL_ENABLED` environment variable (retained only for backward compatibility with older plugins)

### Security
- Secrets referenced via EnvVar are never stored in DeltaFi configuration or transmitted through Valkey message queues

### Tech-Debt/Refactor
- Content API request format changed; UI updated to match
- Cached total unacknowledged error count in ErrorCountService to avoid redundant database queries
- Added `limit` parameter to bulk mutation GraphQL APIs to enable client-controlled batching

### Upgrade and Migration
- Compose: Adding new container deltafi/logrotate:1.0.0-1
- Compose: Adding new container deltafi/vector:0.51.1-alpine-0
- FlowfileEgress action defaults to V1 format for backward compatibility (no action required)
- Recommended: Set `flowFileVersion: V3` in FlowfileEgress action configs for improved efficiency
- Existing SFTP configurations using the password field will continue to work (backward compatible)
- Note that the new EnvVar type is only available to Java actions at this time
- Migration of Minio to s3proxy
  - No data migration required - existing content storage works as-is
  - Existing plugins will continue to work via `deltafi-minio` service alias and `MINIO_*` environment variables
- New container image: deltafi/s3proxy:2.9.0-0
- Upgrade to `victoriametrics/victoria-metrics:v1.132.0`

