#!/usr/bin/env bash

. "$DELTAFICLI_WORKDIR/common"

cli_help_command() {
  echo "
Command: query

Usage:
  query QUERY"
  exit 1
}

ARGS=($@)
[[ " ${ARGS[@]} " =~ " --help " ]] && cli_help_command
[[ ${#ARGS[@]} -lt 2 ]] && cli_help_command

QUERY=${ARGS[@]:1}
QUERY=$(echo $QUERY | sed 's/"/\\"/g')
GRAPHQL_IP=$(deltafi serviceip deltafi-core-service)
POST_QUERY="{ \"query\": \"$QUERY\",\"variables\":null}"

curl -s -X POST -H "Content-Type: application/json" -H "$PERMISSION" -H "$CLI_USER" -d "$POST_QUERY" http://$GRAPHQL_IP/graphql | jq '.'
